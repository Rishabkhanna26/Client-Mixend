{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/db.js"],"sourcesContent":["import pg from 'pg';\n\nconst { Pool } = pg;\n\nlet pool;\n\nconst formatQuery = (text, params = []) => {\n  if (!params.length) return text;\n  let index = 0;\n  return text.replace(/\\?/g, () => `$${++index}`);\n};\n\nexport function getPool() {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: { rejectUnauthorized: false },\n    });\n  }\n  return pool;\n}\n\nexport async function getConnection() {\n  const client = await getPool().connect();\n  const query = async (text, params = []) => {\n    const sql = formatQuery(text, params);\n    const result = await client.query(sql, params);\n    return [result.rows, result];\n  };\n  return {\n    query,\n    execute: query,\n    release: () => client.release(),\n  };\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,MAAM,EAAE,IAAI,EAAE,GAAG,wJAAE;AAEnB,IAAI;AAEJ,MAAM,cAAc,CAAC,MAAM,SAAS,EAAE;IACpC,IAAI,CAAC,OAAO,MAAM,EAAE,OAAO;IAC3B,IAAI,QAAQ;IACZ,OAAO,KAAK,OAAO,CAAC,OAAO,IAAM,CAAC,CAAC,EAAE,EAAE,OAAO;AAChD;AAEO,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,KAAK;YACd,kBAAkB,QAAQ,GAAG,CAAC,YAAY;YAC1C,KAAK;gBAAE,oBAAoB;YAAM;QACnC;IACF;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,UAAU,OAAO;IACtC,MAAM,QAAQ,OAAO,MAAM,SAAS,EAAE;QACpC,MAAM,MAAM,YAAY,MAAM;QAC9B,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,KAAK;QACvC,OAAO;YAAC,OAAO,IAAI;YAAE;SAAO;IAC9B;IACA,OAAO;QACL;QACA,SAAS;QACT,SAAS,IAAM,OAAO,OAAO;IAC/B;AACF"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/db-helpers.js"],"sourcesContent":["import { getConnection } from \"./db\";\n\n// Get all users with their admin info\nexport async function getAllUsers(adminId = null, { search = '', limit = 50, offset = 0 } = {}) {\n  const connection = await getConnection();\n  try {\n    const params = [];\n    const whereParts = [];\n    if (adminId) {\n      whereParts.push('u.assigned_admin_id = ?');\n      params.push(adminId);\n    }\n    if (search) {\n      const q = `%${search.toLowerCase()}%`;\n      whereParts.push('(LOWER(u.name) LIKE ? OR u.phone LIKE ? OR LOWER(u.email) LIKE ?)');\n      params.push(q, q, q);\n    }\n    const whereClause = whereParts.length ? `WHERE ${whereParts.join(' AND ')}` : '';\n    const [users] = await connection.query(\n      `\n        SELECT u.*, a.name as admin_name\n        FROM users u\n        LEFT JOIN admin_accounts a ON u.assigned_admin_id = a.id\n        ${whereClause}\n        ORDER BY u.created_at DESC, u.id DESC\n        LIMIT ?\n        OFFSET ?\n      `,\n      [...params, limit, offset]\n    );\n    return users;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get user by ID\nexport async function getUserById(userId, adminId = null) {\n  const connection = await getConnection();\n  try {\n    const params = [userId];\n    let whereClause = 'WHERE u.id = ?';\n    if (adminId) {\n      whereClause += ' AND u.assigned_admin_id = ?';\n      params.push(adminId);\n    }\n    const [user] = await connection.query(\n      `\n        SELECT u.*, a.name as admin_name\n        FROM users u\n        LEFT JOIN admin_accounts a ON u.assigned_admin_id = a.id\n        ${whereClause}\n      `,\n      params\n    );\n    return user[0];\n  } finally {\n    connection.release();\n  }\n}\n\n// Get all messages with user and admin details\nexport async function getAllMessages(adminId = null, { search = '', limit = 50, offset = 0 } = {}) {\n  const connection = await getConnection();\n  try {\n    const params = [];\n    const whereParts = [];\n    if (adminId) {\n      whereParts.push('m.admin_id = ?');\n      params.push(adminId);\n    }\n    if (search) {\n      const q = `%${search.toLowerCase()}%`;\n      whereParts.push('(LOWER(u.name) LIKE ? OR u.phone LIKE ? OR LOWER(m.message_text) LIKE ?)');\n      params.push(q, q, q);\n    }\n    const whereClause = whereParts.length ? `WHERE ${whereParts.join(' AND ')}` : '';\n    const [messages] = await connection.query(\n      `\n        SELECT m.*, u.name as user_name, u.phone, a.name as admin_name\n        FROM messages m\n        LEFT JOIN users u ON m.user_id = u.id\n        LEFT JOIN admin_accounts a ON m.admin_id = a.id\n        ${whereClause}\n        ORDER BY m.created_at DESC, m.id DESC\n        LIMIT ?\n        OFFSET ?\n      `,\n      [...params, limit, offset]\n    );\n    return messages;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get messages for a specific user\nexport async function getMessagesForUser(\n  userId,\n  adminId = null,\n  { limit = 50, offset = 0, before = null } = {}\n) {\n  const connection = await getConnection();\n  try {\n    const params = [userId];\n    const whereParts = ['m.user_id = ?'];\n    if (adminId) {\n      whereParts.push('m.admin_id = ?');\n      params.push(adminId);\n    }\n    if (before) {\n      whereParts.push('m.created_at < ?');\n      params.push(before);\n    }\n    const whereClause = `WHERE ${whereParts.join(' AND ')}`;\n    const [messages] = await connection.query(\n      `\n        SELECT m.*, u.name as user_name, a.name as admin_name\n        FROM messages m\n        LEFT JOIN users u ON m.user_id = u.id\n        LEFT JOIN admin_accounts a ON m.admin_id = a.id\n        ${whereClause}\n        ORDER BY m.created_at DESC, m.id DESC\n        LIMIT ?\n        OFFSET ?\n      `,\n      [...params, limit, offset]\n    );\n    return messages;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get all requirements with user info\nexport async function getAllRequirements(\n  adminId = null,\n  { search = '', status = 'all', limit = 50, offset = 0 } = {}\n) {\n  const connection = await getConnection();\n  try {\n    const params = [];\n    const whereParts = [];\n    if (adminId) {\n      whereParts.push('u.assigned_admin_id = ?');\n      params.push(adminId);\n    }\n    if (status && status !== 'all') {\n      whereParts.push('r.status = ?');\n      params.push(status);\n    }\n    if (search) {\n      const q = `%${search.toLowerCase()}%`;\n      whereParts.push('(LOWER(u.name) LIKE ? OR LOWER(r.requirement_text) LIKE ?)');\n      params.push(q, q);\n    }\n    const whereClause = whereParts.length ? `WHERE ${whereParts.join(' AND ')}` : '';\n    const [requirements] = await connection.query(\n      `\n        SELECT r.*, u.name, u.phone\n        FROM user_requirements r\n        LEFT JOIN users u ON r.user_id = u.id\n        ${whereClause}\n        ORDER BY r.created_at DESC, r.id DESC\n        LIMIT ?\n        OFFSET ?\n      `,\n      [...params, limit, offset]\n    );\n    return requirements;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function updateRequirementStatus(requirementId, status, adminId = null) {\n  const connection = await getConnection();\n  try {\n    if (adminId) {\n      await connection.query(\n        `UPDATE user_requirements r\n         SET status = ?\n         FROM users u\n         WHERE r.user_id = u.id AND r.id = ? AND u.assigned_admin_id = ?`,\n        [status, requirementId, adminId]\n      );\n    } else {\n      await connection.query(\n        `UPDATE user_requirements SET status = ? WHERE id = ?`,\n        [status, requirementId]\n      );\n    }\n\n    const params = [requirementId];\n    let whereClause = 'WHERE r.id = ?';\n    if (adminId) {\n      whereClause += ' AND u.assigned_admin_id = ?';\n      params.push(adminId);\n    }\n    const [rows] = await connection.query(\n      `SELECT r.*, u.name, u.phone\n       FROM user_requirements r\n       LEFT JOIN users u ON r.user_id = u.id\n       ${whereClause}\n       LIMIT 1`,\n      params\n    );\n    return rows[0] || null;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get all needs with user and admin info\nexport async function getAllNeeds(\n  adminId = null,\n  { search = '', status = 'all', limit = 50, offset = 0 } = {}\n) {\n  const connection = await getConnection();\n  try {\n    const params = [];\n    const whereParts = [];\n    if (adminId) {\n      whereParts.push('u.assigned_admin_id = ?');\n      params.push(adminId);\n    }\n    if (status && status !== 'all') {\n      whereParts.push('n.status = ?');\n      params.push(status);\n    }\n    if (search) {\n      const q = `%${search.toLowerCase()}%`;\n      whereParts.push('(LOWER(u.name) LIKE ? OR LOWER(n.need_text) LIKE ?)');\n      params.push(q, q);\n    }\n    const whereClause = whereParts.length ? `WHERE ${whereParts.join(' AND ')}` : '';\n    const [needs] = await connection.query(\n      `\n        SELECT n.*, u.name, u.phone, a.name as assigned_admin_name\n        FROM user_needs n\n        LEFT JOIN users u ON n.user_id = u.id\n        LEFT JOIN admin_accounts a ON n.assigned_to = a.id\n        ${whereClause}\n        ORDER BY n.created_at DESC, n.id DESC\n        LIMIT ?\n        OFFSET ?\n      `,\n      [...params, limit, offset]\n    );\n    return needs;\n  } finally {\n    connection.release();\n  }\n}\n\n// Add new user\nexport async function addUser(phone, name, email, assigned_admin_id) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `\n        INSERT INTO users (phone, name, email, assigned_admin_id)\n        VALUES (?, ?, ?, ?)\n        RETURNING id\n      `,\n      [phone, name, email, assigned_admin_id]\n    );\n    return rows[0]?.id || null;\n  } finally {\n    connection.release();\n  }\n}\n\n// Add new message\nexport async function addMessage(user_id, admin_id, message_text, message_type) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `\n        INSERT INTO messages (user_id, admin_id, message_text, message_type, status)\n        VALUES (?, ?, ?, ?, 'sent')\n        RETURNING id\n      `,\n      [user_id, admin_id, message_text, message_type]\n    );\n    return rows[0]?.id || null;\n  } finally {\n    connection.release();\n  }\n}\n\n// Get dashboard stats\nexport async function getDashboardStats(adminId = null) {\n  const connection = await getConnection();\n  try {\n    if (!adminId) {\n      const [stats] = await connection.query(`\n        SELECT \n          (SELECT COUNT(*) FROM users) as total_users,\n          (SELECT COUNT(*) FROM messages WHERE message_type = 'incoming') as incoming_messages,\n          (SELECT COUNT(*) FROM user_requirements WHERE status = 'in_progress') as active_requirements,\n          (SELECT COUNT(*) FROM user_needs WHERE status = 'open') as open_needs\n      `);\n      return stats[0];\n    }\n\n    const [stats] = await connection.query(\n      `\n        SELECT\n          (SELECT COUNT(*) FROM users WHERE assigned_admin_id = ?) as total_users,\n          (SELECT COUNT(*) FROM messages WHERE message_type = 'incoming' AND admin_id = ?) as incoming_messages,\n          (SELECT COUNT(*)\n           FROM user_requirements r\n           JOIN users u ON r.user_id = u.id\n           WHERE r.status = 'in_progress' AND u.assigned_admin_id = ?) as active_requirements,\n          (SELECT COUNT(*)\n           FROM user_needs n\n           JOIN users u ON n.user_id = u.id\n           WHERE n.status = 'open' AND u.assigned_admin_id = ?) as open_needs\n      `,\n      [adminId, adminId, adminId, adminId]\n    );\n    return stats[0];\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getAdminById(adminId) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `SELECT id, name, email, phone, admin_tier, status,\n              whatsapp_number, whatsapp_name, whatsapp_connected_at,\n              created_at, updated_at\n       FROM admin_accounts\n       WHERE id = ?\n       LIMIT 1`,\n      [adminId]\n    );\n    return rows[0] || null;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function updateAdminProfile(adminId, { name, email }) {\n  const connection = await getConnection();\n  try {\n    const updates = [];\n    const values = [];\n    if (typeof name === 'string') {\n      updates.push('name = ?');\n      values.push(name.trim());\n    }\n    if (typeof email === 'string') {\n      updates.push('email = ?');\n      values.push(email.trim() || null);\n    }\n    if (updates.length === 0) {\n      return await getAdminById(adminId);\n    }\n    values.push(adminId);\n    await connection.query(\n      `UPDATE admin_accounts SET ${updates.join(', ')} WHERE id = ?`,\n      values\n    );\n    return await getAdminById(adminId);\n  } finally {\n    connection.release();\n  }\n}\n\nfunction parseTemplateVariables(value) {\n  if (!value) return [];\n  try {\n    const parsed = JSON.parse(value);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (err) {\n    return [];\n  }\n}\n\nexport async function getAllBroadcasts(\n  adminId = null,\n  { search = '', limit = 50, offset = 0 } = {}\n) {\n  const connection = await getConnection();\n  try {\n    const params = [];\n    const whereParts = [];\n    if (adminId) {\n      whereParts.push('b.created_by = ?');\n      params.push(adminId);\n    }\n    if (search) {\n      const q = `%${search.toLowerCase()}%`;\n      whereParts.push('(LOWER(b.title) LIKE ? OR LOWER(b.message) LIKE ?)');\n      params.push(q, q);\n    }\n    const whereClause = whereParts.length ? `WHERE ${whereParts.join(' AND ')}` : '';\n    const [rows] = await connection.query(\n      `\n        SELECT b.*, a.name as created_by_name\n        FROM broadcasts b\n        LEFT JOIN admin_accounts a ON b.created_by = a.id\n        ${whereClause}\n        ORDER BY b.created_at DESC, b.id DESC\n        LIMIT ?\n        OFFSET ?\n      `,\n      [...params, limit, offset]\n    );\n    return rows;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getBroadcastStats(adminId = null) {\n  const connection = await getConnection();\n  try {\n    const params = [];\n    let whereClause = '';\n    if (adminId) {\n      whereClause = 'WHERE created_by = ?';\n      params.push(adminId);\n    }\n    const [rows] = await connection.query(\n      `\n        SELECT\n          COUNT(*)::int as total_count,\n          COALESCE(SUM(sent_count), 0)::int as total_sent,\n          COALESCE(SUM(delivered_count), 0)::int as total_delivered,\n          SUM(CASE WHEN status = 'scheduled' THEN 1 ELSE 0 END)::int as scheduled_count\n        FROM broadcasts\n        ${whereClause}\n      `,\n      params\n    );\n    return rows[0] || {\n      total_count: 0,\n      total_sent: 0,\n      total_delivered: 0,\n      scheduled_count: 0,\n    };\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getBroadcastById(broadcastId) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `SELECT b.*, a.name as created_by_name\n       FROM broadcasts b\n       LEFT JOIN admin_accounts a ON b.created_by = a.id\n       WHERE b.id = ?\n       LIMIT 1`,\n      [broadcastId]\n    );\n    return rows[0] || null;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function createBroadcast({\n  title,\n  message,\n  targetAudienceType,\n  scheduledAt,\n  status,\n  createdBy,\n}) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `INSERT INTO broadcasts\n       (title, message, target_audience_type, scheduled_at, status, created_by)\n       VALUES (?, ?, ?, ?, ?, ?)\n       RETURNING id`,\n      [\n        title,\n        message,\n        targetAudienceType || 'all',\n        scheduledAt || null,\n        status || 'draft',\n        createdBy || null,\n      ]\n    );\n    return await getBroadcastById(rows[0]?.id);\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getAllTemplates(\n  adminId = null,\n  { search = '', limit = 50, offset = 0 } = {}\n) {\n  const connection = await getConnection();\n  try {\n    const params = [];\n    const whereParts = [];\n    if (adminId) {\n      whereParts.push('t.created_by = ?');\n      params.push(adminId);\n    }\n    if (search) {\n      const q = `%${search.toLowerCase()}%`;\n      whereParts.push('(LOWER(t.name) LIKE ? OR LOWER(t.category) LIKE ? OR LOWER(t.content) LIKE ?)');\n      params.push(q, q, q);\n    }\n    const whereClause = whereParts.length ? `WHERE ${whereParts.join(' AND ')}` : '';\n    const [rows] = await connection.query(\n      `\n        SELECT t.*, a.name as created_by_name\n        FROM message_templates t\n        LEFT JOIN admin_accounts a ON t.created_by = a.id\n        ${whereClause}\n        ORDER BY t.created_at DESC, t.id DESC\n        LIMIT ?\n        OFFSET ?\n      `,\n      [...params, limit, offset]\n    );\n    return rows.map((row) => ({\n      ...row,\n      variables: parseTemplateVariables(row.variables_json),\n    }));\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getTemplateById(templateId) {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(\n      `SELECT t.*, a.name as created_by_name\n       FROM message_templates t\n       LEFT JOIN admin_accounts a ON t.created_by = a.id\n       WHERE t.id = ?\n       LIMIT 1`,\n      [templateId]\n    );\n    const row = rows[0];\n    if (!row) return null;\n    return { ...row, variables: parseTemplateVariables(row.variables_json) };\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function createTemplate({ name, category, content, variables, createdBy }) {\n  const connection = await getConnection();\n  try {\n    const variablesJson = Array.isArray(variables) ? JSON.stringify(variables) : null;\n    const [rows] = await connection.query(\n      `INSERT INTO message_templates (name, category, content, variables_json, created_by)\n       VALUES (?, ?, ?, ?, ?)\n       RETURNING id`,\n      [name, category, content, variablesJson, createdBy || null]\n    );\n    return await getTemplateById(rows[0]?.id);\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getTeamMembers() {\n  const connection = await getConnection();\n  try {\n    const [rows] = await connection.query(`\n      SELECT\n        a.id,\n        a.name,\n        a.email,\n        a.admin_tier,\n        a.status,\n        SUM(CASE WHEN m.message_type = 'outgoing' THEN 1 ELSE 0 END) AS messages_sent,\n        COUNT(DISTINCT CASE\n          WHEN m.created_at >= (NOW() - INTERVAL '7 days') THEN m.user_id\n          ELSE NULL\n        END) AS active_chats\n      FROM admin_accounts a\n      LEFT JOIN messages m ON m.admin_id = a.id\n      GROUP BY a.id, a.name, a.admin_tier, a.status, a.created_at\n      ORDER BY a.created_at DESC\n    `);\n    return rows;\n  } finally {\n    connection.release();\n  }\n}\n\nexport async function getReportOverview(startDate, adminId = null) {\n  const connection = await getConnection();\n  try {\n    const messageParams = [startDate];\n    let messageWhere = 'WHERE created_at >= ?';\n    if (adminId) {\n      messageWhere += ' AND admin_id = ?';\n      messageParams.push(adminId);\n    }\n    const [messageStats] = await connection.query(\n      `\n        SELECT date_trunc('day', created_at) as date, COUNT(*) as count\n        FROM messages\n        ${messageWhere}\n        GROUP BY date_trunc('day', created_at)\n        ORDER BY date_trunc('day', created_at)\n      `,\n      messageParams\n    );\n\n    if (adminId) {\n      const [leadStats] = await connection.query(\n        `\n          SELECT r.status, COUNT(*) as count\n          FROM user_requirements r\n          JOIN users u ON r.user_id = u.id\n          WHERE u.assigned_admin_id = ?\n          GROUP BY r.status\n        `,\n        [adminId]\n      );\n\n      const [agentPerformance] = await connection.query(\n        `\n          SELECT\n            a.id,\n            a.name,\n            a.admin_tier,\n            a.status,\n            SUM(CASE WHEN m.message_type = 'outgoing' THEN 1 ELSE 0 END) AS messages_sent,\n            COUNT(DISTINCT CASE\n              WHEN m.created_at >= (NOW() - INTERVAL '7 days') THEN m.user_id\n              ELSE NULL\n            END) AS active_chats\n          FROM admin_accounts a\n          LEFT JOIN messages m ON m.admin_id = a.id\n          WHERE a.id = ?\n          GROUP BY a.id, a.name, a.admin_tier, a.status\n        `,\n        [adminId]\n      );\n\n      const [topCampaigns] = await connection.query(\n        `\n          SELECT id, title, status, sent_count, delivered_count, created_at\n          FROM broadcasts\n          WHERE created_by = ?\n          ORDER BY sent_count DESC, created_at DESC\n          LIMIT 5\n        `,\n        [adminId]\n      );\n\n      return {\n        messageStats,\n        leadStats,\n        agentPerformance,\n        topCampaigns,\n        revenueSources: [],\n      };\n    }\n\n    const [leadStats] = await connection.query(\n      `\n        SELECT status, COUNT(*) as count\n        FROM user_requirements\n        GROUP BY status\n      `\n    );\n\n    const [agentPerformance] = await connection.query(`\n      SELECT\n        a.id,\n        a.name,\n        a.admin_tier,\n        a.status,\n        SUM(CASE WHEN m.message_type = 'outgoing' THEN 1 ELSE 0 END) AS messages_sent,\n        COUNT(DISTINCT CASE\n          WHEN m.created_at >= (NOW() - INTERVAL '7 days') THEN m.user_id\n          ELSE NULL\n        END) AS active_chats\n      FROM admin_accounts a\n      LEFT JOIN messages m ON m.admin_id = a.id\n      GROUP BY a.id, a.name, a.admin_tier, a.status, a.created_at\n      ORDER BY a.created_at DESC\n    `);\n\n    const [topCampaigns] = await connection.query(`\n      SELECT id, title, status, sent_count, delivered_count, created_at\n      FROM broadcasts\n      ORDER BY sent_count DESC, created_at DESC\n      LIMIT 5\n    `);\n\n    return {\n      messageStats,\n      leadStats,\n      agentPerformance,\n      topCampaigns,\n      revenueSources: [],\n    };\n  } finally {\n    connection.release();\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 832, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth.js"],"sourcesContent":["import crypto from 'crypto';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'algoaura-dev-secret-key-2024';\n\nexport function hashPassword(password) {\n  const salt = crypto.randomBytes(16).toString('hex');\n  const hash = crypto.scryptSync(password, salt, 64).toString('hex');\n  return `scrypt$${salt}$${hash}`;\n}\n\nexport function verifyPassword(password, storedHash) {\n  if (!storedHash) return false;\n  const parts = storedHash.split('$');\n  if (parts.length !== 3 || parts[0] !== 'scrypt') return false;\n  const salt = parts[1];\n  const hash = parts[2];\n  try {\n    const derived = crypto.scryptSync(password, salt, 64);\n    const stored = Buffer.from(hash, 'hex');\n    if (stored.length !== derived.length) return false;\n    return crypto.timingSafeEqual(stored, derived);\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function signAuthToken(payload) {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\n}\n\nexport function verifyAuthToken(token) {\n  try {\n    return jwt.verify(token, JWT_SECRET);\n  } catch (err) {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,aAAa,QAAQ;IACnC,MAAM,OAAO,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;IAC7C,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,IAAI,QAAQ,CAAC;IAC5D,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE,MAAM;AACjC;AAEO,SAAS,eAAe,QAAQ,EAAE,UAAU;IACjD,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU,OAAO;IACxD,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,MAAM,OAAO,KAAK,CAAC,EAAE;IACrB,IAAI;QACF,MAAM,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM;QAClD,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM;QACjC,IAAI,OAAO,MAAM,KAAK,QAAQ,MAAM,EAAE,OAAO;QAC7C,OAAO,gHAAM,CAAC,eAAe,CAAC,QAAQ;IACxC,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,SAAS,cAAc,OAAO;IACnC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,gBAAgB,KAAK;IACnC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF"}},
    {"offset": {"line": 883, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/lib/auth-server.js"],"sourcesContent":["import { cookies } from 'next/headers';\nimport { verifyAuthToken } from './auth';\n\nexport async function getAuthUser() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get('auth_token')?.value;\n  if (!token) return null;\n  return verifyAuthToken(token);\n}\n\nexport async function requireAuth() {\n  const user = await getAuthUser();\n  if (!user) {\n    const error = new Error('Unauthorized');\n    error.status = 401;\n    throw error;\n  }\n  return user;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAC7C,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,IAAA,gIAAe,EAAC;AACzB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,MAAM,QAAQ,IAAI,MAAM;QACxB,MAAM,MAAM,GAAG;QACf,MAAM;IACR;IACA,OAAO;AACT"}},
    {"offset": {"line": 914, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/app/api/dashboard/stats/route.js"],"sourcesContent":["import { getDashboardStats } from '../../../../lib/db-helpers';\nimport { requireAuth } from '../../../../lib/auth-server';\n\nconst statsCache = new Map();\nconst STATS_TTL_MS = 30_000;\n\nexport async function GET(req) {\n  try {\n    const authUser = await requireAuth();\n    const adminKey = authUser.admin_tier === 'super_admin' ? 'all' : String(authUser.id);\n    const now = Date.now();\n    const cached = statsCache.get(adminKey);\n    if (cached && now - cached.at < STATS_TTL_MS) {\n      return Response.json({ success: true, data: cached.data, meta: { cached: true } });\n    }\n\n    const stats = await getDashboardStats(\n      authUser.admin_tier === 'super_admin' ? null : authUser.id\n    );\n    statsCache.set(adminKey, { at: now, data: stats });\n    return Response.json({ success: true, data: stats, meta: { cached: false } });\n  } catch (error) {\n    if (error.status === 401) {\n      return Response.json({ success: false, error: 'Unauthorized' }, { status: 401 });\n    }\n    return Response.json({ success: false, error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,MAAM,aAAa,IAAI;AACvB,MAAM,eAAe;AAEd,eAAe,IAAI,GAAG;IAC3B,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,sIAAW;QAClC,MAAM,WAAW,SAAS,UAAU,KAAK,gBAAgB,QAAQ,OAAO,SAAS,EAAE;QACnF,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,SAAS,WAAW,GAAG,CAAC;QAC9B,IAAI,UAAU,MAAM,OAAO,EAAE,GAAG,cAAc;YAC5C,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAM,MAAM,OAAO,IAAI;gBAAE,MAAM;oBAAE,QAAQ;gBAAK;YAAE;QAClF;QAEA,MAAM,QAAQ,MAAM,IAAA,2IAAiB,EACnC,SAAS,UAAU,KAAK,gBAAgB,OAAO,SAAS,EAAE;QAE5D,WAAW,GAAG,CAAC,UAAU;YAAE,IAAI;YAAK,MAAM;QAAM;QAChD,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;YAAO,MAAM;gBAAE,QAAQ;YAAM;QAAE;IAC7E,EAAE,OAAO,OAAO;QACd,IAAI,MAAM,MAAM,KAAK,KAAK;YACxB,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAChF;QACA,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF"}}]
}