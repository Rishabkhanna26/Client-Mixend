{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///var/www/html/mex-end/app/inbox/page.jsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faEnvelope, faMagnifyingGlass } from '@fortawesome/free-solid-svg-icons';\n\nexport default function InboxPage() {\n  const [messages, setMessages] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [hasMore, setHasMore] = useState(false);\n  const [offset, setOffset] = useState(0);\n  const [search, setSearch] = useState('');\n\n  useEffect(() => {\n    const handle = setTimeout(() => {\n      fetchMessages({ reset: true, nextOffset: 0, searchTerm: search });\n    }, 300);\n    return () => clearTimeout(handle);\n  }, [search]);\n\n  async function fetchMessages({ reset = false, nextOffset = 0, searchTerm = '' } = {}) {\n    if (reset) {\n      setLoading(true);\n    } else {\n      setLoadingMore(true);\n    }\n    try {\n      const params = new URLSearchParams();\n      params.set('limit', '50');\n      params.set('offset', String(nextOffset));\n      if (searchTerm) params.set('q', searchTerm);\n      const response = await fetch(`/api/messages?${params.toString()}`);\n      const data = await response.json();\n      const list = data.data || [];\n      const meta = data.meta || {};\n      setHasMore(Boolean(meta.hasMore));\n      setOffset(meta.nextOffset ?? nextOffset + list.length);\n      if (reset) {\n        setMessages(list);\n      } else {\n        setMessages((prev) => [...prev, ...list]);\n      }\n    } catch (error) {\n      console.error('Failed to fetch messages:', error);\n      if (reset) {\n        setMessages([]);\n        setHasMore(false);\n        setOffset(0);\n      }\n    } finally {\n      setLoading(false);\n      setLoadingMore(false);\n    }\n  }\n\n  const filteredMessages = messages;\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-screen\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-aa-orange mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading messages...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-4 flex items-center gap-2\">\n          <FontAwesomeIcon icon={faEnvelope} className=\"text-aa-orange\" style={{ fontSize: 32 }} />\n          Inbox\n        </h1>\n        \n        <div className=\"relative\">\n          <FontAwesomeIcon\n            icon={faMagnifyingGlass}\n            className=\"absolute left-3 top-3 text-gray-400\"\n            style={{ fontSize: 20 }}\n          />\n          <input\n            type=\"text\"\n            placeholder=\"Search by name, phone, or message...\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-aa-orange\"\n          />\n        </div>\n      </div>\n\n      <div className=\"space-y-3\">\n        {filteredMessages.length === 0 ? (\n          <div className=\"text-center py-12 bg-gray-50 rounded-lg\">\n            <FontAwesomeIcon icon={faEnvelope} className=\"mx-auto text-gray-400 mb-2\" style={{ fontSize: 48 }} />\n            <p className=\"text-gray-500\">No messages found</p>\n          </div>\n        ) : (\n          filteredMessages.map((msg) => (\n            <div\n              key={msg.id}\n              className=\"bg-white p-4 rounded-lg border border-gray-200 hover:shadow-md transition cursor-pointer\"\n            >\n              <div className=\"flex justify-between items-start\">\n                <div className=\"flex-1\">\n                  <h3 className=\"font-semibold text-gray-900\">{msg.user_name} ({msg.phone})</h3>\n                  <p className=\"text-sm text-gray-600 mt-1\">{msg.message_text}</p>\n                </div>\n                <span\n                  className={`px-3 py-1 rounded-full text-xs font-semibold ${\n                    msg.message_type === 'incoming'\n                      ? 'bg-blue-100 text-blue-800'\n                      : 'bg-green-100 text-green-800'\n                  }`}\n                >\n                  {msg.message_type}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center mt-2\">\n                <span className=\"text-xs text-gray-500\">\n                  {new Date(msg.created_at).toLocaleDateString()} {new Date(msg.created_at).toLocaleTimeString()}\n                </span>\n                <span className={`text-xs px-2 py-1 rounded ${\n                  msg.status === 'read' ? 'bg-gray-100 text-gray-700' : 'bg-aa-orange/10 text-aa-orange'\n                }`}>\n                  {msg.status}\n                </span>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      {hasMore && (\n        <div className=\"mt-6 flex justify-center\">\n          <button\n            onClick={() => fetchMessages({ reset: false, nextOffset: offset, searchTerm: search })}\n            disabled={loadingMore}\n            className=\"px-5 py-2 rounded-full border border-aa-orange text-aa-orange font-semibold hover:bg-aa-orange hover:text-white transition disabled:opacity-60 disabled:cursor-not-allowed\"\n          >\n            {loadingMore ? 'Loading...' : 'Load more'}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}